@using DAL
@using DAL.Models
@model DAL.oClasses.ODelivery

@{
    //ViewData["Title"] = "SalesInvoice";
    Layout = "~/Views/Shared/_LayoutTablePages.cshtml";
}



@{


    string Form_DepositMaster_ActionMethod = "";
    int? DV_ID = ViewBag.DV_ID;



    Form_DepositMaster_ActionMethod = "Insert_DepositReturnMaster";


    //--viewbag for showing total
    ViewBag.Total_Amount = null;


}




<header class="page-header">
    <h2>Deposit</h2>

    <div class="right-wrapper text-right">
        <ol class="breadcrumbs">
            <li>
                <a href="@ViewBag.Home_Dashboard">
                    <i class="fas fa-home"></i>
                </a>
            </li>
            <li><a asp-area="" asp-controller="Purchases" asp-action="PurchaseList"><span>Deposit</span></a></li>
            <li><a asp-area="" asp-controller="@ViewBag.BreadCumController" asp-action="@ViewBag.BreadCumAction"><span>Deposit Recieve</span></a></li>

        </ol>

        <a class="sidebar-right-toggle"></a>
    </div>
</header>


<div class="row" id="SuccessErrorSection">
    @if (TempData["Success"] != null || TempData["Error"] != null)
    {
        <div class="col-lg-12">
            @if (TempData["Success"] != null)
            {
                <div class="alert alert-info">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                    <strong>Success!</strong> @TempData["Success"] <a href="" class="alert-link"></a>
                </div>
            }

            @if (TempData["Error"] != null)
            {
                <div class="alert alert-danger">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                    <strong>Error!</strong> @TempData["Error"] <a href="" class="alert-link"></a>
                </div>
            }
        </div>
    }


</div>


<!-- start: page -->
<section class="card">
    <div class="card-body">
        <div class="invoice">
            <header class="clearfix">
                <div class="row">
                    <div class="col-sm-7 mt-0">
                        <h2 class="h4 text-dark font-weight-bold">Deposit >> Customer and Vehicle Details</h2>



                    </div>

                    <div class="col-sm-5" style="text-align:right;">
                        <button type="submit" id="ButtonSave" class="mb-1 mt-1 mr-1 btn btn-sm btn-success">Save &nbsp;<i class="fas fa-save"></i></button>
                        <button type="button" class="mb-1 mt-1 mr-1 btn btn-sm btn-danger">Cancel &nbsp;<i class="fas fa-times"></i></button>
                        <button type="button" class="mb-1 mt-1 mr-1 btn-sm btn-info" id="print-btn">Print &nbsp;<i class="fas fa-print"></i></button>
                        <button type="button"  @ViewBag.AttachmentVisibility class="btn-sm btn btn btn-default" style="background-color: #68889E; color:white; border-color:#2F3E48" onclick="ShowAttachmentMaster('@Model.DepositMasterObj.DV_ID');">Attachment &nbsp;<i class="fa fa-paperclip"></i></button>
                     
                        <a asp-controller="Delivery" asp-action="DepositList" class="mb-1 mt-1 mr-1 btn btn-sm btn-default">List &nbsp;<i class="fas fa-list"></i></a>

                    </div>


                </div>
            </header>

            <div class="row">

                <div class="col">

                    <form method="post" asp-area="" asp-controller="Delivery" asp-action="@Form_DepositMaster_ActionMethod" id="formDepositMaster">
                        @Html.AntiForgeryToken()

                        <section class="card">

                            <div class="card-body">

                                <div class="row form-group">
                                    <div class="col-lg-4">


                                        <div class="row MasterForm">
                                            <label for="To" class="col-sm-4 col-form-label">Customer Name</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" id="Customer_Name" name="Customer_Name" value="@Model.DepositMasterObj.CUSTOMER_NAME" placeholder="Customer Name" required readonly>

                                                <!--hidden field for saving customer id-->
                                                <input type="hidden" class="form-control" id="Customer_ID" name="Customer_ID" value="@Model.DepositMasterObj.Customer_ID">

                                                <!--hidden master id field-->
                                                <input type="hidden" id="DV_ID" name="DV_ID" value="@DV_ID" />
                                            </div>
                                        </div>
                                        <div class="row MasterForm">
                                            <label for="To" class="col-sm-4 col-form-label">Contact</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" id="Customer_Contact" name="Customer_Contact" value="@Model.DepositMasterObj.CUSTOMER_CONTACT" placeholder="Contact Number" readonly>
                                            </div>
                                        </div>




                                        <div class="row MasterForm">
                                            <label for="refund_Customer" class="col-sm-4 col-form-label">Refund Name*</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" id="refund_Customer" name="refund_Customer" value="@Model.DepositMasterObj.refund_Customer" placeholder="Refund Customer">
                                            </div>
                                        </div>



                                    </div>
                                    <div class="col-lg-4">

                                        <div class="row MasterForm">
                                            <label for="ExportTo_Destination_ID" class="col-sm-4 col-form-label">Destination</label>
                                            <div class="col-sm-8">
                                                <select class="form-control" id="export_to_Destination_ID" name="export_to_Destination_ID" asp-items="@(new SelectList( ViewBag.ExportDestinations,"Destinations_ID","Destinations",Model.DepositMasterObj.export_to_Destination_ID))" readonly>
                                                    <option>Select Export To</option>

                                                </select>

                                            </div>
                                        </div>

                                        <div class="row MasterForm">
                                            <label for="port_ID" class="col-sm-4 col-form-label">Port Exit</label>
                                            <div class="col-sm-8">
                                                <select class="form-control" id="port_ID" name="port_ID" asp-items="@(new SelectList( ViewBag.PortOfExit,"PortOfExit_ID","PortOfExit", Model.DepositMasterObj.port_ID))" readonly>
                                                    <option>Select Port</option>

                                                </select>

                                            </div>
                                        </div>

                                        <div class="row MasterForm">
                                            <label for="To" class="col-sm-4 col-form-label">Contact(Refund)*</label>
                                            <div class="col-sm-8">
                                                <input type="text" multiple class="form-control" id="refund_Contact" name="refund_Contact" value="@Model.DepositMasterObj.refund_Contact" placeholder="Contact(Refund)">
                                            </div>
                                        </div>

                                    </div>

                                    <div class="col-lg-4 ">


                                        <div class="row MasterForm">
                                            <label for="DV_Ref" class="col-sm-4 col-form-label">Ref No</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" id="DV_Ref" name="DV_Ref" value="@Model.DepositMasterObj.DV_Ref" readonly>
                                            </div>
                                        </div>

                                        <div class="row MasterForm">
                                            <label for="Date_Taken" class="col-sm-4 col-form-label">Date Taken</label>
                                            <div class="col-sm-8">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fas fa-calendar-alt"></i>
                                                        </span>
                                                    </span>


                                                    @if (!String.IsNullOrEmpty(Model.DepositMasterObj.Date_Taken))
                                                    {
                                                        <input type="text" data-plugin-datepicker class="form-control" autocomplete="off" id="Date_Taken" name="Date_Taken" value="@Model.DepositMasterObj.Date_Taken" readonly>

                                                    }
                                                    else
                                                    {
                                                        <input type="text" data-plugin-datepicker class="form-control" autocomplete="off" id="Date_Taken" name="Date_Taken" value="@DateTime.Now.ToShortDateString()" readonly>

                                                    }


                                                </div>
                                            </div>


                                        </div>



                                        <div class="row MasterForm">
                                            <label for="Date_Return" class="col-sm-4 col-form-label">Return Date*</label>
                                            <div class="col-sm-8">
                                                <div class="input-group">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fas fa-calendar-alt"></i>
                                                        </span>
                                                    </span>

                                                    <input type="text" data-plugin-datepicker class="form-control" autocomplete="off" id="Date_Return" name="Date_Return" value="@Model.DepositMasterObj.Date_Return">



                                                </div>
                                            </div>


                                        </div>

                                    </div>


                                </div>




                            </div>


                        </section>




                    </form>


                </div>

            </div>

            <div class="row">


                <div class="col-sm-6 col-lg-6 col-md-6 mt-0">
                    <h4 class="header-row font-weight-bold"> Chassis Details </h4>

                </div>


                <div class="col-sm-6 col-lg-6 col-md-6 mt-1 text-right">
                    <button class="btn btn-sm btn-primary" disabled="disabled">Add New &nbsp;<i class="fas fa-plus"></i></button>

                </div>

            </div>







            <div class="row">

                <div id="DepositVoucherDetailSection">

                    <table class="table table-responsive-md table-bordered mb-0">
                        <thead>
                            <tr>

                                <th>Chassis</th>
    
                                <th>Deposit</th>
                                <th>Fix Charge</th>
                                <th>Paper</th>
                                <th>Security</th>
                                <th>Others</th>
                                <th>SubmitDate</th>
                                <th>Ref</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model.DepositsDetailList.Any())
                            {


                                foreach (Deposits_DAL item in Model.DepositsDetailList)
                                {

                                    ViewBag.Total_Amount = item.Total_Amount;


                                    <tr>

                                        <td>@Html.DisplayFor(modelItem => item.Chassis_No)</td>
                                       

                                        <td>@Html.DisplayFor(modelItem => item.Deposit)</td>
                                        <td>@Html.DisplayFor(modelItem => item.Fix_Deductable_Charges)</td>
                                        <td>@Html.DisplayFor(modelItem => item.PaperExpense_Changes)</td>
                                        <td>@Html.DisplayFor(modelItem => item.VAT_Security_Deposit)</td>
                                        <td>@Html.DisplayFor(modelItem => item.Other_Charges)</td>
                                        <td>@Html.DisplayFor(modelItem => item.Submission_Date)</td>
                                        <td>@Html.DisplayFor(modelItem => item.External_Trans_Ref)</td>


                                    </tr>


                                }
                            }


                        </tbody>

                    </table>


                    <div class="invoice-summary">

                        <div class="row">



                            <div class="col-lg-9 col-md-9">

                            </div>

                            <div class="col-lg-3 col-md-3 justify-content-end text-right">
                                <table class="table h6 text-dark">
                                    <tbody>

                                        <tr class="b-top-0">
                                            <td colspan="2"> Total Amount:</td>
                                            <td class="text-right" id="">@ViewBag.Total_Amount</td>
                                        </tr>




                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>

                </div>


            </div>




        </div>

    </div>
</section>


<section class="card">
    <div class="card-body">
        <header class="clearfix">
            <div class="row">
                <div class="col-sm-6 col-lg-6 col-md-6 mt-0">
                    @*<h3 class="h4 mt-0 mb-2 text-dark font-weight-bold"></h3>*@

                    <h4 class="header-row font-weight-bold text-dark"> Deposit >> Recieved </h4>

                </div>


                <div class="col-sm-6 col-lg-6 col-md-6  text-right">
                    <button class="btn btn-sm btn-primary" disabled="disabled">Add New &nbsp;<i class="fas fa-plus"></i></button>

                </div>


            </div>
        </header>
        <div id="ReceiptDetailSection">

            <table class="table table-responsive-md table-bordered mb-0">
                <thead>
                    <tr>

                        <th>On Account</th>
                        <th>Amount</th>
                        <th>Description</th>

                        <th>Payment Mode</th>
                        <th>Cheque Details</th>



                    </tr>
                </thead>
                <tbody>

                    @if (Model.receiptDetailList != null)
                    {


                        foreach (pa_ReceiptDetails_DAL item in Model.receiptDetailList)
                        {



                    <tr>



                        <td>@Html.DisplayFor(modelItem => item.DR_AcountName)</td>
                        <td>@Html.DisplayFor(modelItem => item.Amount)</td>
                        <td>@Html.DisplayFor(modelItem => item.Description)</td>
                        <td>@Html.DisplayFor(modelItem => item.CR_AccountName)</td>
                        <td>
                            <b> @Html.DisplayFor(modelItem => item.Cheque_Bank_Name)</b>
                            <i>  @Html.DisplayFor(modelItem => item.Cheque_no)</i>
                            <b>  @Html.DisplayFor(modelItem => item.cheque_Date)</b>

                        </td>


                    </tr>


                        }
                    }


                </tbody>

            </table>



        </div>


    </div>
</section>



<section class="card">
    <div class="card-body">
        <header class="clearfix">
            <div class="row">

                <div class="col-sm-6 col-lg-6 col-md-6 mt-0">
                    <h4 class="header-row font-weight-bold text-dark"> Deposit >> Return </h4>

                </div>


                <div class="col-sm-6 col-lg-6 col-md-6  text-right">
                    <button class="btn btn-sm btn-primary" data-toggle="modal" data-target="#AddNewPaymentDetailModal">Add New &nbsp;<i class="fas fa-plus"></i></button>

                </div>




            </div>
        </header>
        <div id="DepsitReturnDetailSection">

            <table class="table table-responsive-md table-bordered mb-0">
                <thead>
                    <tr>
                        <th>Edit/Delete</th>
                        <th>On Account</th>

                        <th>Description</th>
                        <th>Pay Via</th>
                        <th>Ref</th>
                        <th>Amount</th>
                        <th>VAT Charges</th>
                        <th>Total Amount</th>

                    </tr>
                </thead>
                <tbody>

                    @if (Model.paymentDetailList != null)
                    {


                        foreach (Pa_PaymentDetails_DAL item in Model.paymentDetailList)
                        {


                            ViewBag.Vat_ExpTotal = item.VatExpTotal;
                            ViewBag.AmountTotal = item.AmountTotal;
                            ViewBag.Grand_Total = item.Grand_Total;


                            <tr>




                                <td>
                                    <a onclick="UpdatePaymentDetailGeneral('@item.PaymentDetails_ID'	,'@item.DR_accountID', '@item.Amount', '@item.VAT_Rate', '@item.Currency_ID', '@item.Currency_Rate', '@item.Amount_Others',
	                                    '@item.CR_accountID', '@item.Description', '@item.trans_ref','@item.cheque_bank_name','@item.cheque_date', '@item.cheque_no', '@item.VAT_Exp', '@item.Total_Amount');" data-toggle="modal" data-target="#UpdateNewPaymentDetailModal"><img style="width: 20px;" src="~/Img/Icons/edit.png" /></a>
                                    <a onclick="DeletePaymentDetail('@item.PaymentDetails_ID');" data-toggle="modal" data-target="#DeletePaymentDetailModal"><img style="width: 20px;" src="~/Img/Icons/delete.png" /></a>

                                </td>

                                <td>@Html.DisplayFor(modelItem => item.DR_AccountName)</td>
                                <td>@Html.DisplayFor(modelItem => item.Description)</td>
                                <td>@Html.DisplayFor(modelItem => item.CR_AcountName)</td>
                                <td>@Html.DisplayFor(modelItem => item.trans_ref)</td>
                                <td>@Html.DisplayFor(modelItem => item.Amount)</td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.VAT_Exp)
                                </td>
                                <td>@Html.DisplayFor(modelItem => item.Total_Amount)</td>


                            </tr>
                        }
                    }

                </tbody>

            </table>



        </div>


    </div>
</section>


<!--Insert Payment detail model-->
<div class="modal fade bs-modal-lg in" id="AddNewPaymentDetailModal" tabindex="-1" role="dialog" aria-hidden="true" style=" padding-right: 17px;">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header" style="background: #f6f6f6;">


                <h4 class="modal-title">Payment Details</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>

            </div>

            <form method="post" data-ajax="true" data-ajax-success="mySuccessInsertPaymentDetail" data-ajax-failure="myFailureInsertPaymentDetail"
                  asp-area="" asp-controller="Delivery" asp-action="InsertDepositReturnPaymentDetail" data-ajax-loading="" id="FormInsertPaymentDetail">

                <div class="modal-body">

                    <section class="card">

                        <div class="card-body">



                            <div class="form-body">
                                <div class="row">
                                    @if (Model.DepositMasterObj.DV_ID != 0)
                                    {
                                        <input id="hdDV_ID" name="hdDV_ID" type="hidden" value="@Model.DepositMasterObj.DV_ID" />
                                    }
                                    else

                                    {

                                        <input id="hdDV_ID" name="hdDV_ID" type="hidden" value="0" />
                                    }
                                    <div class="col-md-3">
                                        <div class="form-group">
                                         
                                            <label class="control-label">Account*</label>
                                            <select class="form-control" id="DR_accountID" name="DR_accountID" readonly>
                                                <option value="14" selected>Deposit</option>
                                            </select>

                                        </div>
                                    </div>
                                    <!--/span-->

                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="control-label">Amount*</label>
                                            <input type="number" id="Amount" name="Amount" class="form-control" step="any" placeholder="Enter Amount" onblur="CalculateSumAmount()" required>

                                        </div>
                                    </div>

                                    <!--/span-->

                                    <div class="col-md-3">
                                        <label class="control-label">Currency & Rate</label>
                                        <div class="form-group">
                                            <div class="row">
                                                <div class="col-md-5 col-sm-5" style="padding:0; padding-left:12px;">
                                                    <select class="form-control" id="Currency_ID" name="Currency_ID" asp-items="@(new SelectList( ViewBag.CurrencyList,"Currency_ID","Currency_ShortName"))">
                                                        @*<option>SELECT</option>*@
                                                    </select>
                                                </div>
                                                <div class="col-md-7 col-sm-7" style="padding:0;">
                                                    <input type="number" id="Currency_Rate" name="Currency_Rate" step="any" onblur="CalculateSumAmount()" value="1" class="form-control" placeholder="Rate">

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--/span-->
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="control-label">Other Amount </label>
                                            <input type="text" id="Amount_Others" name="Amount_Others" step="any" class="form-control" placeholder="Other Amount" readonly>

                                        </div>
                                    </div>
                                    <!--/span-->
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="control-label">Pay Via*</label>

                                            <select class="form-control" id="CR_accountID" name="CR_accountID" asp-items="@(new SelectList( ViewBag.CR_accountIDList,"Account_ID","AccountName"))" required>
                                                <option>Select</option>
                                            </select>

                                        </div>
                                    </div>
                                    <!--/span-->
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="control-label">Description</label>
                                            <input type="text" id="Description" name="Description" class="form-control" placeholder="Enter Description here">

                                        </div>
                                    </div>

                                    <!--/span-->
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="control-label">Ref </label>

                                            <input type="text" id="trans_ref" name="trans_ref" class="form-control" placeholder="Reference">


                                        </div>
                                    </div>
                                    <!--/span-->
                                </div>
                                <div class="row">

                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="control-label">Bank</label>
                                            <input type="text" id="cheque_bank_name" name="cheque_bank_name" class="form-control" placeholder="Bank">

                                        </div>
                                    </div>
                                    <!--/span-->

                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="control-label">Cheque Date </label>

                                            <div class="input-group">
                                                <span class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="fas fa-calendar-alt"></i>
                                                    </span>
                                                </span>

                                                <input type="text" data-plugin-datepicker class="form-control" autocomplete="off" id="cheque_date" name="cheque_date">

                                            </div>


                                        </div>
                                    </div>
                                    <!--/span-->

                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="control-label">Cheque # </label>
                                            <input type="text" id="cheque_no" name="cheque_no" class="form-control" placeholder="Cheque #">

                                        </div>
                                    </div>


                                    <div class="col-md-3 col-lg-3">
                                        <label class="control-label">VAT Charges </label>
                                        <div class="form-group">
                                            <div class="row">
                                                <div class="col-md-5 col-sm-5" style="padding:0; padding-left:12px;">
                                                    <select class="form-control" id="VAT_Rate" name="VAT_Rate" onchange="CalculateSumAmount()">
                                                        <option value="0">0%</option>
                                                        <option value="5">5%</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-7 col-sm-7" style="padding:0;">
                                                    <input type="text" id="VAT_Exp" name="VAT_Exp" step="any" class="form-control" placeholder="total" readonly>

                                                </div>
                                            </div>
                                        </div>
                                    </div>



                                </div>

                                <div class="row">
                                    <div class="col-md-3 col-lg-3">
                                        <div class="form-group">
                                            <label class="control-label">Total </label>
                                            <input type="text" id="Total_Amount" name="Total_Amount" step="any" class="form-control" placeholder="total" readonly>

                                        </div>
                                    </div>
                                </div>




                            </div>


                        </div>



                    </section>
                </div>

                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Add</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                </div>
            </form>

        </div>
    </div>
</div>




<!-- Modal Update payment detail-->
<div class="modal fade bs-modal-lg in" id="UpdateNewPaymentDetailModal" tabindex="-1" role="dialog" aria-hidden="true" style=" padding-right: 17px;">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header" style="background: #f6f6f6;">


                <h4 class="modal-title">Payment Details</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>

            </div>

            <form method="post" data-ajax="true" data-ajax-success="mySuccessUpdatePaymentDetail" data-ajax-failure="myFailureUpdatePaymentDetail"
                  asp-area="" asp-controller="Delivery" asp-action="UpdateDepositReturnPaymentDetail" data-ajax-loading="" id="FormUpdatePaymentDetail">

                <div class="modal-body">

                    <section class="card">

                        <div class="card-body">



                            <div class="form-body">
                                <div class="row">
                                    @if (Model.DepositMasterObj.DV_ID != 0)
                                    {
                                        <input id="hdDV_ID" name="hdDV_ID" type="hidden" value="@Model.DepositMasterObj.DV_ID" />
                                    }
                                    else

                                    {

                                        <input id="hdDV_ID" name="hdDV_ID" type="hidden" value="0" />
                                    }
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="control-label">Account*</label>
                                            <select class="form-control" id="DR_accountIDUpdate" name="DR_accountID" readonly>
                                                <option value="14">Deposit</option>
                                            </select>

                                            <!--payment detail id-->
                                            <input type="hidden" id="PaymentDetails_IDUpdate" name="PaymentDetails_ID" />

                                        </div>
                                    </div>
                                    <!--/span-->


                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="control-label">Amount*</label>
                                            <input type="number" id="AmountUpdate" name="Amount" step="any" class="form-control PSum" placeholder="Enter Amount" onblur="CalSumAmountsPaymentUdpate()" required>

                                        </div>
                                    </div>

                                    <!--/span-->

                                    <div class="col-md-3">
                                        <label class="control-label">Currency & Rate</label>
                                        <div class="form-group">
                                            <div class="row">
                                                <div class="col-md-5 col-sm-5" style="padding:0; padding-left:5px;">
                                                    <select class="form-control" id="Currency_IDUpdate" name="Currency_ID" asp-items="@(new SelectList( ViewBag.CurrencyList,"Currency_ID","Currency_ShortName"))">
                                                        @*<option>SELECT</option>*@
                                                    </select>
                                                </div>
                                                <div class="col-md-7 col-sm-7" style="padding:0;">
                                                    <input type="number" id="Currency_RateUpdate" name="Currency_Rate" step="any" onblur="CalSumAmountsPaymentUdpate()" value="1" class="form-control" placeholder="Rate">

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--/span-->
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="control-label">Other Amount </label>
                                            <input type="text" id="Amount_OthersUpdate" name="Amount_Others" step="any" class="form-control" placeholder="Other Amount" readonly>

                                        </div>
                                    </div>
                                    <!--/span-->
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="control-label">Pay Via*</label>

                                            <select class="form-control" id="CR_accountIDUpdate" name="CR_accountID" asp-items="@(new SelectList( ViewBag.CR_accountIDList,"Account_ID","AccountName"))" required>
                                                <option>Select</option>
                                            </select>

                                        </div>
                                    </div>
                                    <!--/span-->
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="control-label">Description</label>
                                            <input type="text" id="DescriptionUpdate" name="Description" class="form-control" placeholder="Enter Description here">

                                        </div>
                                    </div>

                                    <!--/span-->
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="control-label">Ref </label>

                                            <input type="text" id="trans_refUpdate" name="trans_ref" class="form-control" placeholder="Reference">


                                        </div>
                                    </div>
                                    <!--/span-->
                                </div>
                                <div class="row">

                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="control-label">Bank</label>
                                            <input type="text" id="cheque_bank_nameUpdate" name="cheque_bank_name" class="form-control" placeholder="Bank">

                                        </div>
                                    </div>
                                    <!--/span-->

                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="control-label">Cheque Date </label>


                                            <div class="input-group">
                                                <span class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="fas fa-calendar-alt"></i>
                                                    </span>
                                                </span>

                                                <input type="text" data-plugin-datepicker class="form-control" autocomplete="off" id="cheque_dateUpdate" name="cheque_date">

                                            </div>

                                        </div>
                                    </div>
                                    <!--/span-->

                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="control-label">Cheque # </label>
                                            <input type="text" id="cheque_noUpdate" name="cheque_no" class="form-control" placeholder="Cheque #">

                                        </div>
                                    </div>


                                    <div class="col-md-3 col-lg-3">
                                        <label class="control-label">VAT Charges </label>
                                        <div class="form-group">
                                            <div class="row">
                                                <div class="col-md-5 col-sm-5" style="padding:0; padding-left:12px;">
                                                    <select class="form-control" id="VAT_RateUpdate" name="VAT_Rate" onchange="CalSumAmountsPaymentUdpate()">
                                                        <option value="0">0%</option>
                                                        <option value="5">5%</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-7 col-sm-7" style="padding:0;">
                                                    <input type="text" id="VAT_ExpUpdate" name="VAT_Exp" step="any" class="form-control" placeholder="total" readonly>

                                                </div>
                                            </div>
                                        </div>
                                    </div>



                                </div>

                                <div class="row">
                                    <div class="col-md-3 col-lg-3">
                                        <div class="form-group">
                                            <label class="control-label">Total </label>
                                            <input type="text" id="Total_AmountUpdate" name="Total_Amount" step="any" class="form-control" placeholder="total" readonly>

                                        </div>
                                    </div>
                                </div>


                            </div>


                        </div>



                    </section>
                </div>

                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Update</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                </div>
            </form>

        </div>
    </div>
</div>


<!-- Modal Delete PaymentDetail -->
<div class="modal fade bs-modal-lg" id="DeletePaymentDetailModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header" style="background: #f6f6f6;">


                <h4 class="modal-title">Delete Payment Detail</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>

            </div>

            <form method="post" data-ajax="true" data-ajax-success="SuccessDeletePayment" data-ajax-failure="FailureDeletePayment"
                  asp-area="" asp-controller="Delivery" asp-action="DeleteDepositReturnPaymentDetail" data-ajax-loading="">

                <div class="modal-body">

                    <section class="card">

                        <div class="card-body" style="box-shadow:none;">


                            <div class="row form-group">

                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <h3>Do you want to delete this record?</h3>

                                        <input type="hidden" id="PaymentDetails_ID_Delete" name="PaymentDetails_ID" />

                                    </div>
                                </div>


                            </div>


                        </div>



                    </section>
                </div>

                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Confirm</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                </div>
            </form>

        </div>
    </div>
</div>

<!-- Modal show attachment -->
<div class="modal fade bs-modal-lg" id="ShowAttachmentMasterModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <!-- Following fields is for making a central sales master id for attachments -->
        <input type="hidden" id="DepositMain" name="DepositMain" />

        <div class="modal-content" id="AttachmentsDV">

        </div>
    </div>
</div>


@section Scripts {



    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    <script src="~/jquery-ajax-unobtrusive/jquery.unobtrusive-ajax.min.js"></script>



    <script>


        //---show attachment popup
        function ShowAttachmentMaster(DV_ID) {
            debugger
            var TeamDetailPostBackURL = '/Delivery/GetDepositInvoice_Attachments';

            //--assign value to DV_ID hidden field in the main. Dont remove this fields
            $("#DepositMain").val(DV_ID);


            if (!DV_ID) {
                alert("ID is null. Please try again!");
            } else {
                $.ajax({
                    type: "GET",
                    url: TeamDetailPostBackURL,
                    contentType: "application/json; charset=utf-8",
                    data: { "DV_ID": DV_ID },
                    datatype: "json",
                    success: function (data) {


                        if (data.message == undefined) {
                            $('#AttachmentsDV').html(data);


                            //--assign value to DV_ID hidden field. this field is in partial view '_SalesInvoiceAttachment'
                            $("#DV_ID_Attachment").val(DV_ID);

                            $('#ShowAttachmentMasterModal').modal('show');

                        } else {
                            alert(data.message);
                            $('#ShowAttachmentMasterModal').modal('hide');
                        }

                    },
                    error: function () {
                        alert("Dynamic content load failed.");
                    }
                });
            }



        }


        //---after successfull submission of attachment
        function mySuccessAttachment(data) {

            debugger
            if (data.message == undefined) {


                $('#AttachmentsDV').html(data);

                //---assign id of sales master to the hidden field DV_ID_Attachment after partial view refresh
                var DV_ID = document.getElementById("DepositMain").value;
                $("#DV_ID_Attachment").val(DV_ID);



            } else {
                alert(data.message);

            }


        }

        //---if error occured in insertion of attachment
        function myFailureAttachment() {

            alert("Failured occured. Please try again!");

        }


        //---Delete Attachment
        function DeleteAttachment(Attachment_ID, Master_ID, Type, File_Name) {
            debugger
            var TeamDetailPostBackURL = '/Delivery/DeleteAttachmentDeposit';

            //--in this function , the 'Type' is for the field in attachment table for specifying different voucher documents

            var DV_ID = Master_ID;
            if (!DV_ID) {
                alert("Attachment ID is null. Please try again!");
            } else {
                $.ajax({
                    type: "GET",
                    url: TeamDetailPostBackURL,
                    contentType: "application/json; charset=utf-8",
                    data: { "DV_ID": DV_ID, "Attachment_ID": Attachment_ID, "Type": Type, "File_Name": File_Name },
                    datatype: "json",
                    success: function (data) {


                        if (data.message == undefined) {
                            $('#AttachmentsDV').html(data);


                            //--assign value to DV_ID hidden field. this field is in partial view '_SalesInvoiceAttachment'
                            $("#DV_ID_Attachment").val(DV_ID);



                        } else {
                            alert(data.message);
                            //$('#ShowAttachmentMasterModal').modal('hide');
                        }

                    },
                    error: function () {
                        alert("Dynamic content load failed.");
                    }
                });
            }



        }



        $(document).ready(function () {
            $("#ButtonSave").click(function () {
                $("#formDepositMaster").submit();
            });
        });


        //---this function will hit after success submission of insert paymnet detail form
        function mySuccessInsertPaymentDetail(data) {

            var SuccessDiv = " <div class='col-lg-12'><div class='alert alert-info'><button type='button' class='close' data-dismiss='alert' aria-hidden='true'>×</button><strong>Success!</strong> Saved Successfully! <a href ='' class='alert-link'></a></div></div>";
            debugger
            if (data.message == undefined) {

                //$('#AddNewPurchaseModal').modal('hide');
                $('#DepsitReturnDetailSection').html(data);
                $('#SuccessErrorSection').html(SuccessDiv).show();

                $('#AddNewPaymentDetailModal').modal('hide');
                //reset form after success
                $('#FormInsertPaymentDetail').trigger("reset");


            } else {
                alert(data.message);

            }


        }
        //---this function will hit when error occured in submission of payment detail
        function myFailureInsertPaymentDetail() {

            alert("Failured occured. Please try again!");
        }

        //---this function will hit after success submission of Update paymnet detail form
        function mySuccessUpdatePaymentDetail(data) {

            var SuccessDiv = " <div class='col-lg-12'><div class='alert alert-info'><button type='button' class='close' data-dismiss='alert' aria-hidden='true'>×</button><strong>Success!</strong> Saved Successfully! <a href ='' class='alert-link'></a></div></div>";
            debugger
            if (data.message == undefined) {

                //$('#AddNewPurchaseModal').modal('hide');
                $('#DepsitReturnDetailSection').html(data);
                $('#SuccessErrorSection').html(SuccessDiv).show();

                $('#UpdateNewPaymentDetailModal').modal('hide');
                //reset form after success
                $('#FormUpdatePaymentDetail').trigger("reset");


            } else {
                alert(data.message);

            }


        }
        //---this function will hit when error occured in submission of payment detail
        function myFailureUpdatePaymentDetail() {

            alert("Failured occured. Please try again!");
        }


        //---delete payment detail
        function DeletePaymentDetail(PaymentDetails_ID) {
            $("#PaymentDetails_ID_Delete").val(PaymentDetails_ID);
        }

        //---after successfull deleting of purchase detail
        function SuccessDeletePayment(data) {

            var SuccessDiv = " <div class='col-lg-12'><div class='alert alert-info'><button type='button' class='close' data-dismiss='alert' aria-hidden='true'>×</button><strong>Success!</strong> Deleted Successfully! <a href='' class='alert-link'></a></div></div>";
            debugger
            if (data.message == undefined) {
                //alert("Saved Successfully!");
                $('#DeletePaymentDetailModal').modal('hide');
                $('#DepsitReturnDetailSection').html(data);
                $('#SuccessErrorSection').html(SuccessDiv).show();;



            } else {
                alert(data.message);
                $('#DeletePaymentDetailModal').modal('hide');
            }


        }

        //---after failure deleting of purchase detail
        function FailureDeletePayment() {

            alert("Failured occured. Please try again!");
            $('#DeletePaymentDetailModal').modal('hide');
        }

       $(document).ready(function(){
    $("#print-btn").click(function(event){
        event.preventDefault();

        var win = window.open("@Url.Action("DepositReturn", "Report")" + "?DV_ID=" + $("#DV_ID").val() , "_blank");
        win.focus();
    });
        })
    </script>

    <script>

        //---function for calculating amounts in the payment detail pop up form insert
        function CalculateSumAmount() {
            debugger
            var Amount = 0;
            var VAT_Rate = 0;
            var Currency_Rate = 1;


            var Amount_Others = 0;
            var VAT_Exp = 0;
            var Total_Amount = 0;


            Amount = document.getElementById("Amount").value;
            VAT_Rate = document.getElementById("VAT_Rate").value;
            Currency_Rate = document.getElementById("Currency_Rate").value;

            Amount_Others = document.getElementById("Amount_Others").value;
            VAT_Exp = document.getElementById("VAT_Exp").value;
            Total_Amount = document.getElementById("Total_Amount").value;


            if (!Amount) {
                Amount = 0;
            }
            if (!VAT_Rate) {
                VAT_Rate = 0;
            }
            if (!Currency_Rate) {
                Currency_Rate = 1;
            }
            if (!Amount_Others) {
                Amount_Others = 0;

            }
            if (!VAT_Exp) {
                VAT_Exp = 0;
            }
            if (!Total_Amount) {
                Total_Amount = 0;
            }



            //---calculate sum vat exp
            VAT_Exp = VAT_Rate * Amount / 100;
            $("#VAT_Exp").val(VAT_Exp);

            Total_Amount = (Number(Amount) + Number(VAT_Exp));
            $("#Total_Amount").val(Total_Amount);

            //---calculate Amount_Others
            Amount_Others = Amount * Currency_Rate;
            $("#Amount_Others").val(Amount_Others);




        }


        //---function for calculating amounts in the payment detail pop up form Update
        function CalSumAmountsPaymentUdpate() {
            debugger
            var AmountUpdate = 0;
            var VAT_RateUpdate = 0;
            var Currency_RateUpdate = 1;


            var Amount_OthersUpdate = 0;
            var VAT_ExpUpdate = 0;
            var Total_AmountUpdate = 0;


            AmountUpdate = document.getElementById("AmountUpdate").value;
            VAT_RateUpdate = document.getElementById("VAT_RateUpdate").value;
            Currency_RateUpdate = document.getElementById("Currency_RateUpdate").value;

            Amount_OthersUpdate = document.getElementById("Amount_OthersUpdate").value;
            VAT_ExpUpdate = document.getElementById("VAT_ExpUpdate").value;
            Total_AmountUpdate = document.getElementById("Total_AmountUpdate").value;


            if (!AmountUpdate) {
                AmountUpdate = 0;
            }
            if (!VAT_RateUpdate) {
                VAT_RateUpdate = 0;
            }
            if (!Currency_RateUpdate) {
                Currency_RateUpdate = 1;
            }
            if (!Amount_OthersUpdate) {
                Amount_OthersUpdate = 0;

            }
            if (!VAT_ExpUpdate) {
                VAT_ExpUpdate = 0;
            }
            if (!Total_AmountUpdate) {
                Total_AmountUpdate = 0;
            }



            //---calculate sum vat exp
            VAT_ExpUpdate = VAT_RateUpdate * AmountUpdate / 100;
            $("#VAT_ExpUpdate").val(VAT_ExpUpdate);

            Total_AmountUpdate = (Number(AmountUpdate) + Number(VAT_ExpUpdate));
            $("#Total_AmountUpdate").val(Total_AmountUpdate);

            //---calculate Amount_Others
            Amount_OthersUpdate = AmountUpdate * Currency_RateUpdate;
            $("#Amount_OthersUpdate").val(Amount_OthersUpdate);




        }


        //----Assigning values to Update purchase detail form
        function UpdatePaymentDetailGeneral(PaymentDetails_ID, DR_accountID, Amount, VAT_Rate, Currency_ID, Currency_Rate, Amount_Others, CR_accountID, Description, trans_ref, cheque_bank_name,
            cheque_date, cheque_no, VAT_Exp, Total_Amount) {



            debugger

            $("#PaymentDetails_IDUpdate").val(PaymentDetails_ID);
            $("#DR_accountIDUpdate").val(DR_accountID);
            $("#AmountUpdate").val(Amount);
            $("#VAT_RateUpdate").val(VAT_Rate);
            $("#Currency_IDUpdate").val(Currency_ID);
            $("#Currency_RateUpdate").val(Currency_Rate);
            $("#Amount_OthersUpdate").val(Amount_Others);
            $("#CR_accountIDUpdate").val(CR_accountID);
            $("#DescriptionUpdate").val(Description);
            $("#trans_refUpdate").val(trans_ref);
            $("#cheque_bank_nameUpdate").val(cheque_bank_name);
            $("#cheque_dateUpdate").val(cheque_date);
            $("#cheque_noUpdate").val(cheque_no);
            $("#VAT_ExpUpdate").val(VAT_Exp);
            $("#Total_AmountUpdate").val(Total_Amount);


        }


    </script>

}
